name: Package Unreal Engine Project

on:
  push:
    branches:
      - master
    paths-ignore:
      - 'Windows/**'
      - 'Build/**'
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: self-hosted
    name: Package Unreal Engine Game
    steps:
      # 1. 코드 체크아웃
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Unreal Engine 프로젝트 패키징
      - name: Package Project
        env: 
          UE_PATH: 'D:\UE_5.4' # Unreal Engine 설치 경로
          PROJECT_PATH: 'E:\dohan\AcherOfLegend\AcherOfLegend\AcherOfLegend.uproject' # 프로젝트 파일 경로
          OUTPUT_PATH: 'E:\dohan\AcherOfLegend\AcherOfLegend\BuildOutput' # 패키징 결과 저장 경로
        shell: pwsh
        run: |
          & "$env:UE_PATH\Engine\Build\BatchFiles\RunUAT.bat" BuildCookRun `
            -project="$env:PROJECT_PATH" `
            -noP4 -platform=Win64 -clientconfig=Development `
            -cook -allmaps -build -stage -pak -archive `
            -archivedirectory="$env:OUTPUT_PATH"
        
      # 3. Windows 폴더 압축
      - name: Compress Windows Folder
        shell: pwsh
        run: |
          cd "E:\dohan\AcherOfLegend\AcherOfLegend\BuildOutput"
          if (Test-Path "Windows.zip") { Remove-Item "Windows.zip" }
          Compress-Archive -Path Windows -DestinationPath Windows.zip
